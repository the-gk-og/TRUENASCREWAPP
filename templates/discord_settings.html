{% extends "base.html" %}

{% block title %}Discord Settings{% endblock %}

{% block content %}
<div class="card">
    <h2><i class="fab fa-discord"></i> Discord Integration</h2>
    <p style="color: #666; margin-top: 0.5rem;">Link your Discord account to get notifications about events and join them via reactions.</p>
</div>

<div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
    <!-- Link Discord Account -->
    <div class="card">
        <h3 style="margin-bottom: 1rem;"><i class="fab fa-discord"></i> Link Discord Account</h3>
        
        <div id="linkedStatus" style="display: none; background: #d1fae5; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid var(--success);">
            <h4 style="color: var(--success); margin-bottom: 0.5rem;"><i class="fas fa-check-circle"></i> Discord Linked</h4>
            <p>Username: <strong id="discordUsername"></strong></p>
            <button onclick="showModal('unlinkModal')" class="btn btn-danger" style="margin-top: 1rem;">
                <i class="fas fa-unlink"></i> Unlink Account
            </button>
        </div>
        
        <div id="linkStatus" style="display: none; background: #fee2e2; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid var(--danger);">
            <h4 style="color: var(--danger); margin-bottom: 0.5rem;"><i class="fas fa-exclamation-circle"></i> Discord Not Linked</h4>
            <p>Follow the steps below to link your Discord account.</p>
        </div>
        
        <div style="background: #f0f4ff; padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--primary);">
            <h4 style="margin-bottom: 1rem; color: var(--primary);">How to Link:</h4>
            <ol style="margin-left: 1.5rem; line-height: 1.8;">
                <li>Use command <code>/link-account</code> in Discord</li>
                <li>Enter your Production Crew username</li>
                <li>Follow the verification process</li>
                <li>Your account will be linked automatically</li>
            </ol>
        </div>
    </div>
    
    <!-- Benefits -->
    <div class="card">
        <h3 style="margin-bottom: 1rem;"><i class="fas fa-gift"></i> Benefits</h3>
        
        <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
            <p style="margin-bottom: 0.75rem;"><i class="fas fa-bell" style="color: var(--warning);"></i> <strong>Event Notifications</strong></p>
            <p style="color: #666; font-size: 0.9rem; margin: 0;">Get pinged 1 week before and on the day of events you're assigned to.</p>
        </div>
        
        <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
            <p style="margin-bottom: 0.75rem;"><i class="fas fa-hand-paper" style="color: var(--secondary);"></i> <strong>React to Join</strong></p>
           <!--<p style="color: #666; font-size: 0.9rem; margin: 0;">React with ‚úã to add yourself to events directly from Discord.</p>--> 
        </div>
        
        <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
            <p style="margin-bottom: 0.75rem;"><i class="fas fa-comments" style="color: var(--success);"></i> <strong>Team Communication</strong></p>
            <p style="color: #666; font-size: 0.9rem; margin: 0;">Collaborate with your crew team on Discord while managing events here.</p>
        </div>
    </div>
</div>

<!-- Event Notifications Preview -->
<div class="card" style="margin-top: 2rem;">
    <h3 style="margin-bottom: 1rem;"><i class="fas fa-bell"></i> Notification Examples</h3>
    
    <div style="display: grid; gap: 1rem;">
        <!-- Event Created Notification -->
        <div style="background: linear-gradient(135deg, #6366f1 0%, #ec4899 100%); color: white; padding: 1.5rem; border-radius: 8px;">
            <h4 style="margin-bottom: 0.5rem;">üé≠ New Event: Spring Musical</h4>
            <p style="margin-bottom: 0.5rem; opacity: 0.9;">Join this amazing production!</p>
            <p style="font-size: 0.9rem; margin-bottom: 0.5rem;"><strong>üìÖ</strong> May 15, 2024 at 06:00 PM</p>
            <p style="font-size: 0.9rem; margin-bottom: 1rem;"><strong>üìç</strong> School Auditorium</p>
            <!-- <p style="font-size: 0.85rem; opacity: 0.8;">React with ‚úã to add yourself to this event!</p> -->
        </div>
        
        <!-- Reminder Notification -->
        <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 1.5rem; border-radius: 8px;">
            <h4 style="margin-bottom: 0.5rem;">üé≠ Reminder: Spring Musical</h4>
            <p style="margin-bottom: 0.5rem; opacity: 0.9;">Event happening TODAY!</p>
            <p style="font-size: 0.9rem; margin-bottom: 0.5rem;"><strong>‚è∞</strong> May 15, 2024 at 06:00 PM</p>
            <p style="font-size: 0.9rem;"><strong>üìç</strong> School Auditorium</p>
        </div>
    </div>
</div>

<!-- Unlink Modal -->
<div id="unlinkModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="hideModal('unlinkModal')">&times;</span>
        <h2 style="margin-bottom: 1.5rem; color: var(--danger);">‚ö†Ô∏è Unlink Discord Account</h2>
        <p style="margin-bottom: 1.5rem; color: #666;">
            Are you sure you want to unlink your Discord account? You will stop receiving Discord notifications and won't be able to join events via Discord reactions.
        </p>
        <div style="display: flex; gap: 1rem;">
            <button onclick="unlinkDiscord()" class="btn btn-danger" style="flex: 1;">
                <i class="fas fa-unlink"></i> Unlink
            </button>
            <button onclick="hideModal('unlinkModal')" class="btn btn-primary" style="flex: 1;">
                Cancel
            </button>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
function loadDiscordStatus() {
    fetch('/settings/discord-status')
        .then(r => r.json())
        .then(data => {
            if (data.linked) {
                document.getElementById('linkedStatus').style.display = 'block';
                document.getElementById('linkStatus').style.display = 'none';
                document.getElementById('discordUsername').textContent = data.discord_username;
            } else {
                document.getElementById('linkedStatus').style.display = 'none';
                document.getElementById('linkStatus').style.display = 'block';
            }
        });
}

function unlinkDiscord() {
    if (!confirm('Are you sure? You will stop receiving Discord notifications.')) return;
    
    const data = {
        discord_id: null,
        discord_username: null
    };
    
    fetch('/settings/link-discord', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(r => r.json())
    .then(result => {
        if (result.success) {
            showAlert('Discord account unlinked', 'success');
            setTimeout(() => location.reload(), 1000);
        } else {
            showAlert(result.error, 'error');
        }
    });
}

// Load status on page load
document.addEventListener('DOMContentLoaded', loadDiscordStatus);
</script>
{% endblock %}